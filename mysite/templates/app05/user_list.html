<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    {% load static %}
    <link href="{% static 'bootstrap-3.4.1/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'dist/sweetalert.min.css' %}" rel="stylesheet" >
    <script src="{% static 'jquery.min.js' %}"></script>
    <script src="{% static 'bootstrap-3.4.1/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'dist/sweetalert.min.js' %}"></script>

    <style>
        div.sweet-alert h2 {
            padding-top: 10px;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-6 col-md-offset-3">
            <h2 class="text-center"> 用户列表 </h2>
            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <td>ID</td>
                    <td>username</td>
                    <td>age</td>
                    <td>gender</td>
                    <td>actions</td>
                </tr>
                </thead>

                <tbody>
                {% for user_obj in user_queryset %}
                    <tr>
                        <td>{{ user_obj.pk }}</td>
                        <td>{{ user_obj.username }}</td>
                        <td>{{ user_obj.age }}</td>
                        <td>{{ user_obj.get_gender_display }}</td>
                        <td>
                            <button id="id_edit" class="btn btn-primary btn-xs">编辑</button>
                            <button id="id_del" class="btn btn-danger btn-xs del" delete_id="{{ user_obj.pk }}">删除</button>
                        </td>
                    </tr>
                {% endfor %}


                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    $('.del').on('click', function (args) {
        let currentBtn = $(this)  // 将当前标签对象存储起来
        // sweetalert二次确认弹框
        swal({
                title: "删除用户",
                text: "你真的确定要删除吗",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "我不管,就要删",
                cancelButtonText: "算了算了,不删了",
                closeOnConfirm: false,
                closeOnCancel: false,
                showLoaderOnConfirm: true
            },
            function (isConfirm) {
                if (isConfirm) {
                    $.ajax({
                        url: '/app05/user/delete/',
                        type: 'post',
                        data: {
                            'delete_id': currentBtn.attr('delete_id')
                        },
                        success: function (args) {
                            if (args.code === 1000) {
                                swal("删除成功!", "好了好了给你删掉了", "success");
                                currentBtn.parent().parent().remove()
                            } else {
                                swal("删除失败!", "出现了意想不到的问题", "error");
                            }
                        }
                    })
                } else {
                    swal("删除取消", "不删了不删了", "error");
                }
            });
    })

</script>


</body>
</html>